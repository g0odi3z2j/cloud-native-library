---
linktitle: 第 15 章：应用 WebAssembly——在云和边缘
summary: 在云和边缘应用 WebAssembly。
weight: 16
icon: book-reader
icon_pack: fas
draft: true
title: 应用 WebAssembly：在云和边缘
date: '2023-01-26T00:00:00+08:00'
type: book # Do not modify
---

> 我现在从两边看云，从上往下看，还是有一些，我记得是云的幻觉。
> 我真的一点都不了解云层
> -乔尼-米切尔，"两边都是"。

鉴于如今云计算举措的普及和无处不在， ，在本章的开头引用不了解云的说法，可能显得有些奇怪。如果我们是诚实的，我认为可以说很多人都不了解云计算的全部范围。与采购物理硬件系统通常难以维持的情况相比，云计算有明显的速度提高和易于启动实例的特点。但是，把所有的东西都放在云端和把所有的东西都放在云端一样是愚蠢的策略。
你对云战略思考的真正驱动力不应该仅仅是采购和开发人员的生产力，尽管这些是重要的考虑因素。一个更普遍的想法是要考虑计算的成本。从我所说的 "成本 "和 "计算 "的含义来看，这是个比看起来更复杂的计算方法。在这一章中，我将重点讨论我们运行计算的地方是如何快速变化的，以及为什么WebAssembly将成为其中的一个关键部分。

短暂的个人迂回
在我职业生涯的早期，我是一家名为Parabon的公司的首批员工之一。1我们建立了一个互联网分布式计算平台，将世界各地的计算机上的闲置时间聚集在一起。请记住，这是在云计算之前。除了将我们的引擎及其基于Java的核心安全移植到八个平台之外，我们还建立了客户端API，用于调度工作的服务器基础设施，以及半打或更多的垂直应用程序来使用它。我们运行的工作包括线性扩展的基因序列比较，基于遗传算法的特征选择，用于详尽的回归搜索，以及基于蒙特卡洛的渲染系统。
这一举措的全部意义在于寻找计算能力方面的套利机会。各机构没有购买足够的计算能力来满足他们的峰值需求，因此他们在计算上能解决的问题是有上限的。我们为一类问题提供了弹性能力，这类问题被称为 "令人尴尬的并行 " 问题的弹性能力.客户可以根据他们解决一个特定问题的需要，要求获得尽可能多或尽可能少的计算资源。这给了他们一个旋钮，让他们根据自己的需要来产生边际成本。
当做详尽的搜索时，这使他们能够包括比他们通常有资源来分析的更多特征。在一个案例中，这对一家制药公司来说是很有帮助的，它可以找出为什么某种疗法只对某些病人有效而对其他病人无效。另一个良好匹配的例子是美国国家航空航天局（NASA）的一位顾问，他能够加快他的模拟，从他在正常情况下可以使用的设备上花费九个月的时间，到我们的平台上花费四五个小时。为了实现在各种操作系统之间的可移植性和我们对计算提供者承诺的保护，他不得不把他的代码从Fortran移植到Java。虽然Fortran在直接竞争中可以绕过当时Sun公司的新秀语言，但我们会用并行化来弥补它。
即使有令人尴尬的并行问题约束的限制，考虑到当时宽带推广的情况，像数字渲染这样的数据密集型任务并不适合我们的平台。计算与数据的比率太低了。在时间和带宽方面花费太多，无法将数据送到需要的地方。我们从根本上提供的是一种计算中介的形式。即使在当时，我觉得需要更多的东西才能真正提供最大的价值，但云计算还没有出现，不能给我们一个更全面的资源虚拟化的视野。




1这些天。 Parabon 专注于计算和DNA的交叉，用于下一代疗法和 法医工具，如用于解决悬案的工具。有一个基于其与CeCe Moore的工作的流行电视节目，叫做《遗传侦探》。

另一个推动我思考的工作经历是我在视频游戏行业的时间。我曾在一个游戏中工作，这个游戏是基于另一个有4000万用户的游戏，所以我们非常确定我们需要扩大规模。然而，把所有的东西都放到云端会让人望而却步，所以我们混合使用了我们购买和建立的数据中心设备，然后使用云服务作为弹性溢出。同样，我们能够只在需要的时候使用额外的资源，而不必为它们一直运行而付费。
我们的行业在不断发展
有了这个背景，当我谈到计算的 "成本 "时，我指的是 ，即时间成本、金钱成本、没有弹性供应的机会成本、耗电成本和延迟成本。这些都是我们这些天来试图最小化的成本。云计算是该战略的一部分，但微服务和无服务器功能等架构设计也是如此。苹果的M1设计是另一种。M1芯片中有两个CPU，一个更注重性能，一个更注重功耗。研究人员正在分析复杂的方法，使用机器学习策略来命令LLVM操作化，以实现性能最大化或功耗最小化。应用程序代码并没有改变，只是它的编译形式。
我们在哪里以及如何使用计算元素来解决问题，已经成为成功的IT战略中最重要的方面之一。这包括先进的和定制的硬件，如矢量化的CPU指令。2   图形处理单元（GPU）、现场可编程门阵列（FPGA）。3特定应用集成电路（ASICs）。4和张量处理单元（TPU）。5这些类型的硬件都有不同的能力、指令、成本和性能特征。将工作负载映射到这些元素上，将是以最小化一系列成本的方式完成编译的重要部分。
物理位置是成本的另一个因素，因为如你所知，延迟是我们不能忽视的东西。6如果你熟悉云区域的概念或使用内容交付网络（CDN）来提供静态资源，你会明白让东西更接近用户的好处。域名



2这包括一些技术，如 高级 向量 扩展 （AVX）  和 流式 SIMD 扩展(SSE).
3FPGAsFPGAs 允许根据需要将软件程序写到硬件上。
4ASICsASICs 代表高性能、低能耗、一次性使用的计算元件。
5谷歌开发了 TPUsTPU 根据需要部署在需要提升性能的面向消费者的应用程序上。
6分布式计算的谬误 的谬误  distributed computing分布式计算是值得记住的。

系统（DNS）的诡计允许根据用户来自的地理区域动态地选择一个终端。
边缘计算是一种新兴的服务产品，它将这些想法进一步 ，将分布式计算（à la Parabon）、云主机和地理分布式资源的想法混合在一起。不同的是，我们不再是简单地谈论静态资源，而是可执行的代码。网络架构允许我们把东西一直推到浏览器中。正如你所看到的，WebAssembly在这个用例中有着突出的作用。有时你想在浏览器或设备上进行，因为隐私的原因，低延迟的用户体验，等等。在其他时候，你可能不想在用户的设备上运行专有代码，但仍想接近。这就是边缘计算的领域。它是一个跨越集中式数据中心、区域边界、服务提供商接入点边界、内部系统、本地接入点和设备上的连续部署局部联系。如果说事情变得有点复杂，那是一种成功的轻描淡写的做法。
在这个范围内，隐含着各种硬件架构、隐私模式、对潜在敏感信息的访问以及计算能力。我们对我之前提到的NASA研究员的要求（即把他的代码移植到Java上）在今天不太可能是一个合理的要求。这些环境将需要给客户选择语言的自由，但也要提供保护，以避免他们在多租户系统中互相踩踏。
这种连续的地点的快照可以在下面看到 图 15-1.开发人员出于不同的原因，希望能够在这个范围内部署软件工件。在云中进行大型模型训练和数据分析是有价值的。这些结果可能不适合在移动设备或嵌入式系统上运行。一些服务可以设在离用户更近的地方，以获得低延迟、更好的体验 ces。出于知识产权保护的原因，你可能不想把一些行为一直发送到设备上。在其他情况下，隐私法规，如支付卡行业（PCI），健康保险可携性和责任法案（HIPAA），以及一般数据保护条例（GDPR）将鼓励或要求你。
我们有通过基于容器的环境和Kubernetes驱动的基础设施在云中部署可扩展基础设施的策略。绝大多数在该领域做得好的东西在移动设备或嵌入式系统中完全没有用处。


图15-1.地方和责任的连续性
WebAssembly和WASI提供了一个很好的故事，为所有这些变化提供覆盖。我认为它们将在这一领域大放异彩，并在我们目前所看到的有希望的用途之外大放异彩。在写这篇文章时，我想向你介绍一些领先的项目，但我完全期待这些项目在不久的将来会急剧扩大。
在2021年的一次演讲中中，来自Cosmonic和wasmCloud项目的Liam Randall强调了我一直在讨论的连续体。请看 图15-2，这是基于他展示的一张图片。
我们看到的是我们的行业如何随着时间的推移而改变。开发者需要负责的事情一直在减少。我们可以依靠我们的运行时环境来提供的东西已经增加。最初，我们不得不管理一切。我们必须购买硬件，安装操作系统和补丁，并添加任何依赖的库或应用程序。保持这些系统的补丁是一项全职工作，而且经常会引入与我们的系统所建立的不兼容的情况。
开源操作系统，如Linux和FreeBSD，改变了这个行业。以前涉及昂贵的专利操作系统的许可证变成了免费的。我们可以拥有我们想要的许多副本，但在不同的硬件配置上设置和配置它们的努力仍然是一项昂贵的活动，已经成熟的创新。


图15-2.我们行业的演变
云计算的爆炸性增长引入了一个虚拟化层，我们可以免受硬件细节的影响。这使我们有能力共享物理系统的使用时间。各种操作系统配置的预定义图像的旋转，使我们很容易满足需求，并从一个已知的起点快速移动。这些虚拟机图像很大，很麻烦，而且对各种用途来说都是多余的。对应用程序开发人员来说，管理依赖关系仍然是一个很大的负担，但这是一个进步。
我们所知道的容器系统可以追溯到20世纪70年代的种子，增加了chroot系统。7在2000年。 FreeBSD的Jail系统 出现了，它允许多租户主机进一步区分哪些是共享的，哪些是每个用户独有的。这推动了许多 年后对Linux控制组的兴趣和发展，导致了2008年Linux容器（LXC）的发展。谷歌 和CloudFoundry也有一些产品，但最终是Docker在2013年发布，才真正推动了球的发展。
总的来说，这种容器化的方法比上一代的重量级图像允许更精细的病毒化颗粒度。更多的


7ǞǞǞ chrootchroot 系统通过改变进程及其子进程的根目录来帮助隔离这些进程。

基础设施可以被预定义，因此我们可以专注于安装正确版本的共享库和应用程序。
如你所见，WebAssembly引入了一个新版本的安全、稳定、可移植代码的理念。API的可用性仍然是一个问题，但WASI有助于解决这个问题。在这样的环境中，沙盒代码的概念变得越来越重要，这不仅仅是因为我们在第8章讨论的供应链攻击。 第八章攻击，而且还因为我们希望将代码部署在不同的层次上。 图15-1 在多租户系统中部署代码。正如Liam Randall在他前面链接的演讲中提到的那样，随着基于能力的安全系统越来越受到重视，你可能会期待这种趋势继续下去。
在最近的几章中，我们探讨了通过Wasmtime和Wasmer API加载和执行可重用的WebAssembly模块的应用。最终，这是我们找到自己的最终过渡的基础。这个用例有助于定义一个新的应用程序主机层，它将提供支持插件、模块、扩展、甚至基本功能的选项。代码需要批准的能力来做基本执行以外的事情，如从文件系统中读取、生成线程或打开网络连接。这种方法将促进广泛的使用，如用不同语言编写的带有插件代理和文件服务器的长期运行的应用程序、微服务和无服务器功能。
除了这种灵活的计算风格之外，这些方法的开销甚至比目前大家都很兴奋的容器模型所提供的开销更小，安全性更强。这将使我们能够进入 ，在我们的计算景观中突出显示的整个范围。 图15-1.为了加强我们正在讨论的潜在影响，Docker的联合创始人Solomon Hykes经常在这些讨论中被引用。"如果WASM+WASI在2008年就存在，我们就不需要创建Docker了。这就是它的重要性。服务器上的Webassembly是计算的未来。"8正如他随后承认的那样，这并不一定意味着Docker会消失，而是意味着我们正在谈论同等重要的东西。这两种技术很可能会找到一起工作的方法。
让我们看看这些想法是如何以各种方式结合起来，为我们的异质性和扩展性计算的未来奠定基础的。我们将探索一把商业和开源的产品，作为现在正在考虑的例子。毫无疑问，在我们知道之前会有更多。







8他在 推特.

Fastly Compute@Edge
Fastly在过去十年中一直是一个成功的CDN供应商。它是字节码联盟的创始成员 ber，最近从Mozilla聘请了许多专注于WebAssembly和WASI的工程师。它正在超越为静态内容提供服务的范围，并通过其Compute@Edge平台进入我们所想象的这个新世界。
这项服务的核心是Lucet WebAssembly编译器和运行时， ，与我们在第11章提到的Mozilla Wasmtime项目合并。 第十一章.通过开放源代码并将其贡献给字节码联盟，Fastly希望通过利用这两个运行时的优势使其更加丰富。两者都是围绕 Cranelift 项目当与WASI结合时，将促进客户能够将用各种编程语言编写的功能安全地推入Fastly的Edge@Compute环境。
Lucet运行时的一个决定性特征是它能够在50微秒内实例化WebAssembly模块，而V8做同样的事情需要5毫秒。9除了这个速度优势，它还能以较低的内存开销做到这一点，以千字节而不是几十兆字节计算。
与Compute@Edge平台的互动与您想象的差不多。你注册一个账户并获得对API的访问权，该API由令牌保护。10有一个命令行工具用于启动项目，并通过动态DNS条目将其部署到生态系统中。目前，代码可以用Rust、Assembly- Script或JavaScript编写。许多功能目前还处于测试阶段，但他们正在快速发展，并大量参与相关技术和标准的开发和管理。
虽然在Fastly的系统上部署任意代码需要注册，但其Terrarium平台由于以WebAssembly为基础，很容易在浏览器中探索。它是围绕着 围绕WebAssembly  StudioStudio 构建的，并提供了一种简单的方法来体验在其平台上部署功能的便利性。
开始时，请访问 https://wasm.fastlylabs.com.你应该看到一个有弹出窗口的网站，允许你选择各种项目。这里有面向C、TypeScript和基本Wat代码库的空项目。也有做实际工作的C和Rust例子，如通过HTTPS提交DNS查询，图像处理，获取远程数据的天气应用，与GitHub通信的GraphQL例子，以及节流代理例子。



9Fastly公司宣布关于 open 开源的 LucetLucet 可以在网上找到。
10考虑到注册过程，我将不展示工作实例，但你可以在网上找到更多细节 在线如果你有兴趣的话。

一旦你选择了其中一种项目类型，浏览器就会填入其相关的结构。在这种情况下，我选择了C语言的图像处理例子。每个文件都可以探索和编辑，但我只需点击图中顶部的Build & Deploy按钮。 图15-3.注意，为了方便起见，它为托管的应用程序生成了一个随机的DNS名称。

图15-3.编译和部署的C语言图像处理实例
如果你跟着生成的域名走，你会看到由所选文件main.c生成的HTML，这只是为了彻底显示在 图 15-4.

图15-4.通过浏览器访问已部署的图像处理实例
最后，如果你点击链接将大图锐化20%，你会看到像图15-5中所示的猫的图片。 图15-5.令人激动的不是你可以将一个应用程序发布到网络上并通过浏览器调用它。而是你可以选择你的语言，包括明显不安全的语言，如C，并部署它

快速计算@Edge | 251

在别人的基础设施中进入一个混合架构（有可能为低延迟的互动进行地理图形复制）而不用担心。

图15-5.锐化了20%的猫图像
在部署地点的连续性上，我们主要关注的是边缘计算，正如其名称所示。接下来我们将看看一个解决方案，它将帮助开发 者将WebAssembly模块部署到他们现有的Kubernetes集群中。
克拉斯特
虽然Docker容器提供了隔离和行为依赖机制，但Kubernetes已经成为协调这些容器的主要环境之一，使其成为复杂应用和工作流的自动化部署。这两种技术真的是相互促进的。以至于它们作为部署的引擎是相当紧密地结合在一起的。虽然这在大型云计算部署中不是一个问题，但当我们想针对较小的平台时，这就成了一个问题。最终，我们将寻求一种机制，允许以更轻的结构来表达行为的com-position。但是，找到一种方法将WebAssembly与Kubernetes直接集成是一个合理的目标。这正是微软的DeisLabs团队在过去几年中一直在进行的实验。11
该团队已经确定WebAssembly是部署安全、快速、安全的 软件的另一种方式。他们认为，从这样一个安全的基础开始，比起


11基金会 DeisLabs team团队 主要由曾在Kubernetes软件包管理器Helm工作的人组成。

必须锁定容器实例，这很难做到。他们已经开发了 容器是一个基于Rust的Kubelet（因此得名）。这种方法的其他好处是启动和关闭时间更快，部署的元素比传统容器更小。这为物联网传感器和设备、嵌入式系统和其他受限环境的使用创造了新的机会，同时也与现有的Kubernetes环境兼容。
DeisLabs团队不认为现有的应用程序会突然被重新包装成WebAssembly模块，然而，这绝不是为了取代Docker。相反，它是一个最小功能的Kubelet，基本上 "按原样 "与Kubernetes互动 。与其只使用开放容器倡议（OCI）容器，你可以用WebAssembly和运行时环境来混合和匹配功能。这些运行时层并不固定，但Krustlet在历史上曾与Wasmtime和wasmCloud项目的前身合作过。通过打破Kubernetes和容器之间的耦合，我们期望从 ，这样的努力会带来很酷的东西。值得注意的是，Krustlet已经被云原生计算基金会（CNCF）作为一个沙盒项目采用。
请记住，这主要是扩展WebAssembly现状的一种方式。它最终将允许更广泛的引擎和计算地方与容器和基于Kubernetes的战略相一致。它还强调了我们在协调策略和应用程序主机供应商方面的选择，我们将在接下来讨论。
亚轨道
卫星项目 容器项目 Suborbital项目是在对容器的组成、协调和行为调度解耦的类似兴趣下产生的。该团队最初考虑将Docker容器作为其工作流程的基础，但发现它们有些笨重、缓慢，而且难以保证安全。WebAssembly在整体上更适合，所以让我们看看它是如何形成的。
Suborbital平台有几个部分。首先是一个基于Go的开发 ，用于表达API服务的环境，称为Vektor。这允许对复杂的行为进行简单的表达，包括建立和配置服务器。Vektor指南包括 例 15-1来演示启动一个用Let's Encrypt支持的证书配置的服务器，以及注册和安装简单的处理程序。








亚轨道｜253

例15-1.Vektor服务器样本
输入 "github.com/suborbital/vektor/vk"

server := vk.New(vk.UseAppName("Vektor API Server"), vk.UseDomain("vektor.example.com"))

server.GET("/ping", HandlePing)

if err := server.Start(); err != nil { log.Fatal(err)。
}

func HandlePing(r *http.Request, ctx *vk.Ctx) (interface{}, error) {
返回 "pong", nil
}

下一个元素是一个基于Go的运行时调度功能和可运行的行为，称为Reactr。它可以是一个独立的应用程序，也可以作为一个服务运行，并通过HTTPS连接接受工作 ，提供一个功能即服务（FaaS）的环境。它处理内存管理、能力安全系统，并可以调度用Rust、AssemblyScript和Swift编写的可运行工作。这些函数可以同步、异步地调度，也可以链在一起，以提供一个Unix管道和过滤器式的功能组成模型。
Grav环境是一个基于Go的分布式消息传递网，用于扩展管理组件之间的通信。它被设计成低开销、高弹性，支持各种消息传递方式（如请求/回复和广播）以及内存中和进程间的消息传递模型。然而，它有一个特定的用途，并不打算取代更成熟的、通用的环境，如RabbitMQ或Kafka。
一个全面而一致的命令行工具subo允许你与Suborbital环境相互作用，并隐藏了许多关于特定语言构建系统、容器结构等细节。部署的工件可以以各种方式进行捆绑，并可以在运行时进行增量热交换。
Atmo是将这一切联系起来的最后一块。它是一个服务器端的API框架，用于声明性地管理部署的功能。开发人员可以专注于功能，并依靠基础设施根据需要进行扩展。虽然Atmo本身并不与Kubernetes挂钩，但如果它被配置为自动扩展的基础设施，它可以用来协助。Atmo通过YAML指令文件进行配置，以定义应如何部署和捆绑可运行的功能。这包括管理路由、业务逻辑和状态管理。

Suborbital仍处于测试阶段，但它提供了一个令人信服的运行时 环境的愿景，这就是图15-2中最后一栏所建议的。 图15-2.甚至还有一个名为Flight Deck的Atmo无头版本，它将允许软件即 服务（SaaS）供应商用这个生态系统管理的API和功能自然地扩展他们的应用程序。
边缘人（WasmEdge
我想强调的下一个项目是来自第二州的WasmEdge项目。 第二州.它是一个安全和高性能的WebAssembly运行时，已被CNCF采纳为官方沙盒项目。它也被想象为我们在本章中迄今为止所讨论的一系列地点的目标运行时。
除了我们看到的典型的主机功能外，WasmEdge还有一个测量执行时间消耗的机制，这在尝试无服务器FaaS环境和基于区块链的系统的货币化方面将是非常有用的。Wasmtime也有这种能力，我们将在以下章节看到 章 第16.
WasmEdge团队是一个大的倡导者，他们的概念是 的概念。的概念，这是一个技术套件，包括Javascript，API和Markup。基本的想法是，前端在构建过程中被转换为优化的，静态的单一页面和资产。这使得他们的运行时性能有降低的复杂性和负载负担。虽然前台可能被转换成静态资源，但它们通过与后端API和超媒体系统的互动保持动态行为。
后台可以使用标准的HTTP客户端（如浏览器）或命令行工具（如HTTPie）进行简洁的查询。12
执行一个部署在FaaS上的函数就像下面这样简单，但要小心。我省略了编译后的WebAssembly代码的字节数。
brian@tweezer ~> http https://rpc.ssvm.secondstate.io:8081/api/executables/1
{
"wasm_id":1,
"wasm_sha256":"0xfb413547a8aba56d0349603a7989e269f3846245e51804932b3e02bc0", "wasm_description":"功能即服务（FaaS）"。
"wasm_as_buffer"。{ "类型":"缓冲区", "数据":[
48,
44,
57,
55,
.
.

12访问 HTTPie website网站 来了解为什么它是我最喜欢的命令行HTTP客户端。

.
]
},
"wasm_state":"{}", "wasm_callback_object":"{}"
}
正如你所看到的，新的端点可以通过操作资源来定义。要调用一个端点的行为来发出一个友好的、参数化的问候，你可以发出以下内容。
brian@tweezer ~> echo "来自未来" | http ↵
-f POST https://rpc.ssvm.secondstate.io:8081/api/run/161/say ↵ Content-Type:text/plain
http/1.1 200 ok
Access-Control-Allow-Origin:* 连接: keep-alive
Content-Length: 22
...
Content-Type: text/html; charset=utf-8 Date:Tue, 17 Aug 2021 18:48:13 GMT
ETag。W/"16-kf3Sg+1nPhqMOp7M01tMU9CkSVk"
...

来自未来的问候
WasmEdge提供的其他功能包括基于能力的安全、RockDB支持的存储机制、WASI集成、TensorFlow功能等等。
一个使用该功能的例子被描述为 在 的 第二 州 网站上描述的.这个 的例子使用了一个多任务级联卷积网络（MTCNN）模型，该模型是根据 FaceNet 数据集.
这个例子包括一个指向GitHub仓库的实际代码的链接，以及对通过命令行工具和浏览器构建、部署和调用这一功能的过程的描述。提交一张1927年索尔维会议的著名图片的结果显示在 图 15-6.13










13真的很难强调这张照片中所显示的集体智慧。其中有17位诺贝尔奖得主。你可以在维基百科上找到更多关于这张杰出的照片和它所来自的集会的信息。 在 维基百科厅.


图15-6.在一张著名图片上调用MTCNN模型
从REST API中调用复杂的功能，这本身并不令人震惊。但能够在一个可移植的、高性能的沙盒环境中安全地部署你想运行的代码才是。从测试的角度来看，你也可以在本地以Node.js或其他形式运行相同的行为，这一点同样有用。
除了基本的WASI支持外，WasmEdge还支持在第12章中讨论的几个建议。 第12章 甚至是一个WASI套接字扩展，以增加网络支持。WasmEdge也有一个类似于我们从Wasmer和Wasmtime看到的API，用于将WebAssembly行为嵌入到任意的其他应用程序中。
如果你访问Second State网站，你会发现在区块链、汽车基础设施和其他各种场景的用途中运行WasmEdge的其他例子。我们将在第16章触及其中的一些内容 第16章，但现在我们将专注于 我们最终的WebAssembly应用基础设施运行时。

华夏云网
基金会 wasmCloud project项目 wasmCloud项目是一个复杂的、不断发展的技术集合，以前被称为waSCC（代表WebAssembly安全能力控制器）。它最近被选为CNCF的官方应用运行时间项目，并承诺帮助开发者在我们在本章中讨论的所有地点的协调能力上建立基于角色的模型。我想集中讨论它，因为我认为它有效地解决了解决图15-1最后一列之谜的各种工程决策。 图 15-1.它当然不是唯一可能解决的项目，但就目前而言，它是对这一设想最有力、最全面的提炼。
wasmCloud从基于云的基础设施中提供了一个全面的抽象。行为体的使用允许开发者产生基于消息处理和使用基础设施所提供的能力的业务功能。能力只是一个术语，指的是行为体需要的非功能需求，以使他们的期望得到应用程序运行时间的满足。清晰的分离允许在不同的环境中重复使用，也允许在同一环境中热交换底层实现。
与wasmCloud相关的工具和框架旨在解决将多语言代码库部署到日益多样化的平台上的复杂问题，正如我们之前提到的Liam Randall的演讲中所概述的那样。他们专注于只添加他们需要的部分，这就是他们利用WebAssembly和WASI的原因。该团队最近做出了一个决定，即向Elixir和OTP平台迁移，而不是在这个生态系统中手工制作并发解决方案。他们很久以前就决定将他们的连接性基础设施建立在NATS工具链和框架上，用于自适应边缘和分布式通信。14
你最终得到的是一个跟踪我们行业发展的技术栈，并准备好满足各种运行时配置和场景的需求。让我们快速浏览一下所涉及的层次。
在堆栈的基础上是WebAssembly和WASI。从这里，我们有一个可移植的安全架构，可以在大量的运行时和不同能力和资源的环境中运行。与以前的沙盒环境不同，这给了我们选择语言的自由和高性能结果的好处。这个基础层显示在 图 15-7.






14NATSNATS 也是CNCF的一个官方孵化项目。


图15-7.wasmCloud堆栈的WebAssembly基础
wasmCloud扩展了WebAssembly的基础，包括签名包、减少的锅炉板代码、可组合的角色模型以及水平和垂直的可扩展性。它支持多租户无状态和孤立地执行部署的业务功能。这个层次的特点是 图 15-8.

图15-8.wasmCloud的云层扩展了WebAssembly的基础
wasmCloud基础之上的能力部分是行为体为完成其执行模型所需的可热插拔的非功能依赖。wasmCloud包括一系列预定义的能力，如数据存储、提供网络资源、消息队列等。这些都是可视化的，如 图 15-9.


图15-9.能力为行为者提供非功能要求
开发者将在这些能力的基础上，根据专门需求提供他们自己的提供者。存在于这个层级之上的角色将以孤立的方式存在，或组成业务功能，可以在更丰富的层级中纵向发展。底层分布模型（基于WebAssembly的行为体）仍然相当轻量级，并且可以利用其他环境中约束合适的堆栈所配置的类似能力。与Kubernetes和容器之间的紧密耦合不同，这给组织提供了更多重用的选择。我们展示了开发者在其中花费大部分时间的那一层。 图 15-10.

图15-10。开发人员将大部分时间用于创建和合成演员

最后，所有这些都被连接到一个自我形成和愈合的网状格子网络。它使用全局发现机制，可调整的拓扑结构，并支持各种云供应商的离线和在线执行模式。这种最终的灵活性表现在 图 15-11.

图15-11.网格网络基础设施是灵活的、自我形成的、可愈合的
这些设计选择的总效果是一个能够满足21世纪需求的卓越的生态系统。作为最后一个例子，来自Red Badger的优秀人士公布了他们最近在多个云提供商之间部署wasmCloud集群的实验。它使用了Krustlet和wasmCloud，详细内容在 GitHub.这是一个令人信服的愿景，它可能实现了图15-1所示的演变。 图 15-1.
我完全预计，我们将看到类似技术结构的替代实现。我期待我们在这个 章中提到的其他项目以及我们甚至还没有听说过的新项目能有大作为。权衡和技术演变将在其他倡议中保持一致。开发人员将越来越少地担心他们所使用的基础设施，因此他们可以专注于他们主要被支付来开发的商业价值。鉴于现代软件开发世界的异质性，我不知道还能怎样。
接下来，我们将在架构上最后一次绕道进入去中心化系统的世界，看看我们的WebAssembly系列的相关技术能为我们做什么。
